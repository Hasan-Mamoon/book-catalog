# Book Catalog

A really simple book catalogue. Built with Next.js 14, NextAuth.js, Supabase, and Tailwind CSS.

## Live Demo

https://book-catalog-peach.vercel.app/

## Local Setup

### Prerequisites

- Node.js 18+ and npm
- A Supabase account
- A Google Cloud Console project (for OAuth)

### 1. Clone the Repository

```bash
git clone https://github.com/Hasan-Mamoon/book-catalog.git
cd book-catalog
```

### 2. Install Dependencies

```bash
npm install
```

### 3. Database Setup

#### Create Supabase Project
1. Go to [Supabase](https://supabase.com) and create a new project
2. Wait for the project to be fully set up

#### Create Database Tables

Run the following SQL in your Supabase SQL Editor:

```sql


-- Create users table
create table public.users (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  username text not null default ''::text,
  password text null,
  email text not null,
  provider text null,
  google_id text null,
  constraint users_pkey primary key (id),
  constraint users_email_key unique (email),
  constraint users_google_id_key unique (google_id)
) TABLESPACE pg_default;

-- Create books table
create table public.books (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  title text not null,
  genre text not null,
  author text not null,
  "userId" bigint not null,
  constraint books_pkey primary key (id),
  constraint books_userId_fkey foreign KEY ("userId") references users (id) on update CASCADE on delete CASCADE
) TABLESPACE pg_default;

```

### 4. Google OAuth Setup

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project or select existing one
3. Enable the Google+ API
4. Go to "Credentials" → "Create Credentials" → "OAuth 2.0 Client IDs"
5. Set application type to "Web application"
6. Add authorized redirect URIs:
   - `http://localhost:3000/api/auth/callback/google` (for local development)
   - `https://your-domain.com/api/auth/callback/google` (for production)
7. Save the Client ID and Client Secret

### 5. Environment Variables

Create a `.env.local` file in the project root:
```env
# NextAuth Configuration
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-super-secret-jwt-secret-here

# Google OAuth
GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-google-client-secret

# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=https://your-project-id.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key
```

#### How to Get Each Value:

**NEXTAUTH_SECRET**:
```bash
openssl rand -base64 32
```

**Google Credentials**:
- Found in Google Cloud Console → Credentials

**Supabase Values**:
- Go to your Supabase project → Settings → API
- `NEXT_PUBLIC_SUPABASE_URL`: Project URL
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`: Project API keys → anon public
- `SUPABASE_SERVICE_ROLE_KEY`: Project API keys → service_role (keep secret!)

### 6. Run the Development Server

```bash
npm run dev
```

Visit [http://localhost:3000](http://localhost:3000) to see your application.

## Authentication Flow

### 1. Google OAuth Flow
```
User clicks "Sign in with Google" 
→ Redirected to Google OAuth 
→ User authorizes application 
→ Google returns user data to NextAuth 
→ NextAuth callback checks if user exists in database
→ If new user: Creates user record with Google ID
→ If existing user: Uses existing database record
→ JWT token created with database user ID
→ User redirected to homepage
```

### 2. Credentials Flow
```
User enters email/password 
→ NextAuth verifies credentials against database
→ Password compared using bcrypt
→ If valid: JWT token created with user ID
→ User redirected to homepage
```

### 3. Session Management
- **Strategy**: JWT-based sessions
- **Storage**: HTTP-only cookies
- **Security**: Tokens signed with NEXTAUTH_SECRET
- **Middleware**: Protects routes `/` and `/add-books`

## Troubleshooting

### Common Issues

**"Database error: value is out of range for type bigint"**
- Ensure your `users.id` column can handle large Google IDs
- The app handles this by storing Google IDs separately

**"Unauthorized" errors**
- Check that middleware is properly configured
- Verify session is being created correctly

**Google OAuth not working**
- Verify redirect URIs in Google Console match exactly
- Check that Google+ API is enabled



## License

This project is licensed under the MIT License.

## Author

**Hassan Mamoon**
- GitHub: [@Hasan-Mamoon](https://github.com/Hasan-Mamoon)

## Tech Stack

- **Frontend**: Next.js 14, React, TypeScript
- **Styling**: Tailwind CSS
- **Authentication**: NextAuth.js
- **Database**: Supabase (PostgreSQL)
- **Deployment**: Vercel
---
